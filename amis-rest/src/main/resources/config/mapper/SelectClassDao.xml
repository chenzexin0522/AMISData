<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.amis.dao.SelectClassDao" >

    <resultMap id="selectClassList" type="com.amis.entity.dto.SelectClassDTO">
        <result column="tc_id" property="tc_id" />
        <result column="tc_name" property="tc_name" />
        <result column="tc_number" property="tc_number" />
    </resultMap>

    <select id="selectClass"  resultMap="selectClassList">
        SELECT
            tc_id,
            tc_name,
            tc_number
        FROM tab_class
        WHERE s_id = #{s_id}
    </select>


    <resultMap id="selectCoachList" type="com.amis.entity.dto.SelectCoachDTO">
        <result column="u_id" property="u_id" />
        <result column="u_name" property="u_name" />
        <result column="u_gender" property="u_gender" />
        <result column="u_phone" property="u_phone" />
        <result column="u_password" property="u_password" />
        <result column="u_picture" property="u_picture" />
        <result column="coach_teaching_age" property="coach_teaching_age" />
        <result column="coach_title" property="coach_title" />
        <result column="u_autograph" property="u_autograph" />
        <result column="uuid" property="uuid" />
        <result column="u_role" property="u_role" />
    </resultMap>

    <select id="selectCoach"  resultMap="selectCoachList">
        SELECT
            u_id,
            u_name,
            u_gender,
            u_picture,
            u_phone,
            coach_teaching_age,
            coach_title,
            u_autograph,
            uuid,
            u_role
        FROM tab_user
        WHERE s_id = #{s_id}
    </select>

    <select id="coachSelectClass"  resultMap="selectClassList">
SELECT tc.tc_id,tc.tc_name,COUNT(tus.uc_id) tc_number from tab_class tc LEFT JOIN tab_class_teaching tcc ON tc.tc_id = tcc.tc_id
LEFT JOIN tab_uc_student tus ON tus.tc_id = tc.tc_id WHERE tcc.u_id = #{u_id} GROUP BY tc.tc_id
    </select>


    <resultMap id="selectStudentList" type="com.amis.entity.dto.SelectStudentDTO">
        <result column="uc_id" property="uc_id" />
        <result column="uc_name" property="uc_name" />
        <result column="uc_gender" property="uc_gender" />
        <result column="uc_phone" property="uc_phone" />
        <result column="uc_picture" property="uc_picture" />
        <result column="uc_autograph" property="uc_autograph" />
        <result column="uuid" property="uuid" />
        <result column="eq_mac" property="eq_mac" />
        <result column="u_role" property="u_role" />
    </resultMap>

    <select id="selectStudent"  resultMap="selectStudentList">
        SELECT
        tus.uc_id,
        tus.uc_name,
        tus.uc_gender,
        tus.uc_picture,
        tus.uc_phone,
        tus.uc_autograph,
        tus.uuid,
        tus.eq_mac,
        tus.u_role,
        ROUND( COUNT(IF(ttt.action_set_one &lt;= tr.action_actual_one,true,null)
        AND IF(ttt.action_set_two &lt;= tr.action_actual_two,true,null)
        AND IF(ttt.action_set_three &lt;= tr.action_actual_three,true,null)
        AND IF(ttt.action_set_four &lt;= tr.action_actual_four,true,null))/COUNT(tr.tr_id)*100,2) as past_completion_rate
        FROM tab_uc_student tus LEFT JOIN ${tab_result} tr ON tus.uc_id = tr.uc_id LEFT JOIN ${tab_total_train} ttt ON tr.tt_id = ttt.tt_id
        WHERE tus.tc_id = #{tc_id} GROUP BY tus.uc_id
    </select>
</mapper>